<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h3 mb-0">Agenda</h1>
    <p class="text-muted mb-0">Ranked internal tracker across clients.</p>
  </div>
  <%= link_to 'New agenda item', new_agenda_item_path, class: 'btn btn-new-agenda' %>
</div>

<div class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <%= form_with url: agenda_items_path, method: :get, scope: :filters, class: 'row g-3 align-items-end auto-submit-form', html: { data: { auto_submit: true } } do |form| %>
      <div class="col-md-3">
        <%= form.label :search, 'Keyword', class: 'form-label' %>
        <%= form.text_field :search, value: @filters[:search], class: 'form-control', placeholder: 'Search title or requester' %>
      </div>
      <div class="col-md-3">
        <%= form.label :client_id, 'Client', class: 'form-label' %>
        <% client_options = [['All clients', nil]] + @clients.map { |client| [client.name, client.id] } %>
        <%= form.select :client_id, options_for_select(client_options, @filters[:client_id]), {}, class: 'form-select' %>
      </div>
      <div class="col-md-3">
        <%= form.label :status, class: 'form-label' %>
        <%= form.select :status, options_for_select([['All statuses', nil]] + AgendaItem.statuses.keys.map { |status| [status.titleize, status] }, @filters[:status]), {}, class: 'form-select' %>
      </div>
      <div class="col-md-3">
        <%= form.label :work_stream, 'Work Type', class: 'form-label' %>
        <%= form.select :work_stream, options_for_select([['All work types', nil]] + AgendaItem.work_streams.keys.map { |stream| [stream.titleize, stream] }, @filters[:work_stream]), {}, class: 'form-select' %>
      </div>
    <% end %>
  </div>
</div>

<div class="table-responsive shadow-sm rounded-3">
  <table class="table align-middle mb-0 agenda-table">
    <thead class="agenda-table-header">
      <tr>
        <th scope="col">Rank</th>
        <th scope="col">Title</th>
        <th scope="col">Client</th>
        <th scope="col">Due</th>
        <th scope="col">Status</th>
        <th scope="col">Priority</th>
        <th scope="col">Assignee</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <% @agenda_items.each do |item| %>
        <tr>
          <td class="fw-bold rank-cell table-cell-small"><%= item.rank_score %></td>
          <td class="table-cell-small">
            <div class="fw-semibold"><%= link_to item.title, agenda_item_path(item), class: 'text-decoration-none agenda-title-link' %></div>
            <div class="small text-muted"><%= item.work_stream.titleize %></div>
          </td>
          <td class="table-cell-small"><%= item.client.name %></td>
          <td>
            <% if item.due_on.present? %>
              <span class="badge bg-<%= item.due_state == :overdue ? 'danger' : 'secondary' %>"><%= item.due_on.strftime('%b %d') %></span>
            <% else %>
              <span class="text-muted small">TBD</span>
            <% end %>
          </td>
          <td><span class="badge bg-<%= item.status_badge_color %>"><%= item.status.titleize %></span></td>
          <td><span class="badge bg-<%= item.priority_badge_color %>"><%= item.priority_level.titleize %></span></td>
          <td class="table-cell-small"><%= item.assignee&.full_name || 'Unassigned' %></td>
          <td class="text-end">
            <%= link_to 'View', agenda_item_path(item), class: 'btn btn-outline-secondary btn-sm' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
