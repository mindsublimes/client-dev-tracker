<div class="d-flex justify-content-between align-items-start mb-4">
  <div>
    <p class="text-muted mb-1">Project:
      <% if policy(@sprint.project).show? %>
        <%= link_to @sprint.project.name, project_path(@sprint.project), class: 'text-decoration-none' %>
      <% else %>
        <span><%= @sprint.project.name %></span>
      <% end %>
    </p>
    <h1 class="h3 mb-1"><%= @sprint.name %></h1>
    <div class="text-muted small">
      <%= @sprint.start_date&.strftime('%B %d, %Y') || 'Start TBD' %> -
      <%= @sprint.end_date&.strftime('%B %d, %Y') || 'End TBD' %>
    </div>
  </div>
  <div class="text-end">
    <div class="text-muted small">Sprint cost</div>
    <div class="h4 mb-0"><%= @sprint.cost.present? ? number_to_currency(@sprint.cost) : 'Not estimated' %></div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Total tasks</div>
        <div class="display-6"><%= @sprint_stats[:total] %></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Completed</div>
        <div class="display-6 text-success"><%= @sprint_stats[:completed] %></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">In progress</div>
        <div class="display-6 text-primary"><%= @sprint_stats[:in_progress] %></div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Blocked / Backlog</div>
        <div class="display-6 text-danger"><%= @sprint_stats[:blocked] + @sprint_stats[:backlog] %></div>
      </div>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div>
        <div class="text-muted small">Progress</div>
        <div class="fw-semibold"><%= @sprint_stats[:progress] %>% complete</div>
      </div>
      <div class="flex-grow-1 ms-4">
        <div class="progress" role="progressbar" aria-valuenow="<%= @sprint_stats[:progress] %>" aria-valuemin="0" aria-valuemax="100" style="height: 12px;">
          <div class="progress-bar" style="width: <%= @sprint_stats[:progress] %>%"></div>
        </div>
      </div>
    </div>
    <div class="mt-3">
      <div class="text-muted small mb-1">Sprint goal</div>
      <p class="mb-0"><%= @sprint.goal.presence || 'No sprint goal documented yet.' %></p>
    </div>
  </div>
</div>

<div class="card border-0 shadow-sm mb-4">
  <div class="card-header bg-white">
    <h5 class="mb-0">Assignee Breakdown</h5>
  </div>
  <% if @assignee_breakdown.any? %>
    <div class="table-responsive">
      <table class="table mb-0 align-middle">
        <thead class="agenda-table-header">
          <tr>
            <th>Assignee</th>
            <th class="text-center">Total</th>
            <th class="text-center">In progress</th>
            <th class="text-center">Completed</th>
            <th class="text-center">Backlog</th>
            <th class="text-center">Blocked</th>
          </tr>
        </thead>
        <tbody>
          <% @assignee_breakdown.each do |row| %>
            <tr>
              <td class="table-cell-small"><%= row[:name] %></td>
              <td class="text-center fw-semibold"><%= row[:total] %></td>
              <td class="text-center text-primary"><%= row[:in_progress] %></td>
              <td class="text-center text-success"><%= row[:completed] %></td>
              <td class="text-center text-muted"><%= row[:backlog] %></td>
              <td class="text-center text-danger"><%= row[:blocked] %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="card-body">
      <p class="text-muted mb-0">No tasks have been assigned in this sprint yet.</p>
    </div>
  <% end %>
</div>
